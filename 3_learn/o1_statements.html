<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Shell Program Statements &mdash; Linux Shell Script Programming 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Linux Shell Script Programming 1.0 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">Linux Shell Script Programming 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Shell Program Statements</a><ul>
<li><a class="reference internal" href="#program-heading">Program Heading</a></li>
<li><a class="reference internal" href="#variable-assignments">Variable Assignments</a></li>
<li><a class="reference internal" href="#input-and-output">Input and Output</a></li>
<li><a class="reference internal" href="#logic-tests-flow-control">Logic Tests, Flow Control</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/o1_statements.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="shell-program-statements">
<span id="statements"></span><h1>Shell Program Statements<a class="headerlink" href="#shell-program-statements" title="Permalink to this headline">¶</a></h1>
<div class="section" id="program-heading">
<h2>Program Heading<a class="headerlink" href="#program-heading" title="Permalink to this headline">¶</a></h2>
<p>Each shell script should start with an interpreter declaration, optionally
followed by a comment to describe the purpose of the script. The declaration
begins with the three characters :kbd:<a href="#id1"><span class="problematic" id="id2">`</span></a>#! <a href="#id3"><span class="problematic" id="id4">`</span></a>, followed by the interpreter path.
Comments start with :kbd:<a href="#id5"><span class="problematic" id="id6">`</span></a># <a href="#id7"><span class="problematic" id="id8">`</span></a>. Here is an example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#! /bin/bash</span>
<span class="c"># Script to deploy .rst documents in a git repository</span>
</pre></div>
</div>
</div>
<div class="section" id="variable-assignments">
<h2>Variable Assignments<a class="headerlink" href="#variable-assignments" title="Permalink to this headline">¶</a></h2>
<p>Each variable assignment statement begins with a variable name concatenated
with an equals sign:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">OWNER</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">SECTIONS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="input-and-output">
<h2>Input and Output<a class="headerlink" href="#input-and-output" title="Permalink to this headline">¶</a></h2>
<p>Shell commands assume input comes from virtual device <strong>STDIN</strong> and output goes
to virtual device <strong>STDOUT</strong>. When working at a console, by default the keyboard
is directed to <strong>STDIN</strong>, and <strong>STDOUT</strong> is directed to the console display.</p>
<p>Redirect arguments change the source input or output destination of a command:</p>
<div class="highlight-python"><div class="highlight"><pre>cp -RH $DIR_STATIC/.ht* $DIR_DEPLOY/ &amp;&gt;/dev/null
</pre></div>
</div>
<p>A pipe passes <strong>STDOUT</strong> of a command to <strong>STDIN</strong> of the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>ls | egrep &#39;test.txt&#39;
</pre></div>
</div>
<p>The distinction between redirects and pipes is:</p>
<ul class="simple">
<li>a redirect is an argument to a single command, while</li>
<li>a pipe passes data from the output of one command to the input of another.</li>
</ul>
</div>
<div class="section" id="logic-tests-flow-control">
<h2>Logic Tests, Flow Control<a class="headerlink" href="#logic-tests-flow-control" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$DIR_DOWNLOADS</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span>cp -R <span class="nv">$DIR_DOWNLOADS</span> <span class="nv">$DIR_OUT</span>/
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> ! -d .git <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;No git project name given. Exiting ... &quot;</span>
  <span class="nb">exit </span>1
<span class="k">else</span>
<span class="k">  </span><span class="nv">PROJECT</span><span class="o">=</span><span class="k">${</span><span class="nv">PWD</span><span class="p">##*/</span><span class="k">}</span>
<span class="k">fi</span>

Repeating and <span class="nv">Conditions</span>
<span class="o">=============================</span>

<span class="k">for </span>OPT in <span class="s2">&quot;$@&quot;</span>
<span class="k">do</span>
<span class="k">  case</span> <span class="nv">$OPT</span> in
    -h|--help<span class="o">)</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;\ndoc-deploy.sh [projectname] [options]&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;   projectname  defaults to name of working directory (pwd)&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;   options      -h, --help - displays this text&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;                -n, --nodeploy - builds _deploy but does not push it\n&quot;</span>
      <span class="nb">shift</span>
<span class="nb">      exit</span>
    ;;
    -n|--nodeploy<span class="o">)</span>
      <span class="nv">NODEPLOY</span><span class="o">=</span><span class="s1">&#39;YES&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;No deploy: $NODEPLOY&quot;</span>
      <span class="nb">shift</span>
    ;;
    *<span class="o">)</span>
      <span class="nv">PROJECT</span><span class="o">=</span><span class="nv">$key</span>
      <span class="nb">shift</span>
    ;;
  <span class="k">esac</span>
<span class="k">done</span>


<span class="c"># ===========function to build deployment in a folder==========================</span>

<span class="c"># Compile fresh output for one or more books and copy to deployment folder</span>

makedeployment <span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;$(pwd)$(tput setaf 1) Making output -- $DIR_OUT -- $(tput sgr0)&quot;</span>

  make clean <span class="nv">$MAKE_METHOD</span> <span class="nv">BUILDDIR</span><span class="o">=</span><span class="nv">$DIR_BUILD</span>

  cp -R <span class="nv">$DIR_BUILD</span>/<span class="nv">$MAKE_METHOD</span>/* <span class="nv">$DIR_OUT</span>/

  <span class="c"># Add downloads if they exist</span>
  <span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$DIR_DOWNLOADS</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">    </span>cp -R <span class="nv">$DIR_DOWNLOADS</span> <span class="nv">$DIR_OUT</span>/
  <span class="k">fi</span>

  <span class="c"># Add section-specific static content</span>
  <span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$DIR_STATIC</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">    </span>cp -RH <span class="nv">$DIR_STATIC</span>/* <span class="nv">$DIR_OUT</span>/
    cp -RH <span class="nv">$DIR_STATIC</span>/.ht* <span class="nv">$DIR_OUT</span>/ &amp;&gt;/dev/null <span class="o">||</span> <span class="nv">RC</span><span class="o">=</span><span class="nv">$?</span>
    <span class="c"># if there is a backreference document for the section index --</span>
    <span class="k">if</span> <span class="o">[[</span> -e <span class="nv">$DIR_STATIC</span>/<span class="nv">$BACKREF</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">      </span><span class="nv">BACKTEXT</span><span class="o">=</span><span class="k">$(</span>&lt;<span class="nv">$DIR_STATIC</span>/<span class="nv">$BACKREF</span><span class="k">)</span>
      sed -i s~<span class="s1">&#39;&lt;li&gt;&lt;a href=\&quot;#\&quot;&gt;.*&lt;/a&gt;&#39;</span>~<span class="s2">&quot;&lt;li&gt;$BACKTEXT&quot;</span>~  <span class="nv">$DIR_OUT</span>/index.html
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[[</span> <span class="nv">$RC</span> &gt; 0 <span class="o">]]</span> ; <span class="k">then </span><span class="nb">echo</span> <span class="s2">&quot;$(pwd)$(tput setaf 1) $LINENO: cp -RH $DIR_STATIC/.ht* $DIR_OUT/ $(tput sgr0)&quot;</span> ; <span class="k">fi</span>

<span class="k">  elif</span> <span class="o">[[</span> -e ../<span class="nv">$DIR_STATIC</span>/<span class="nv">$BACKREF</span> <span class="o">]]</span> ; <span class="k">then</span>
    <span class="c"># if there is a backreference document for the main index --</span>
    <span class="nv">BACKTEXT</span><span class="o">=</span><span class="k">$(</span>&lt;../<span class="nv">$DIR_STATIC</span>/<span class="nv">$BACKREF</span><span class="k">)</span>
    sed -i s~<span class="s1">&#39;&lt;li&gt;&lt;a href=\&quot;#\&quot;&gt;.*&lt;/a&gt;&#39;</span>~<span class="s2">&quot;&lt;li&gt;$BACKTEXT&quot;</span>~  <span class="nv">$DIR_OUT</span>/index.html
  <span class="k">fi</span>

<span class="o">}</span>

<span class="c"># =============================================================================</span>

<span class="c">########## CHECK FOR OPTIONS, ASSIGN INPUTS</span>

<span class="k">for </span>OPT in <span class="s2">&quot;$@&quot;</span>
<span class="k">do</span>
<span class="k">  case</span> <span class="nv">$OPT</span> in
    -h|--help<span class="o">)</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;\ndoc-deploy.sh [projectname] [options]&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;   projectname  defaults to name of working directory (pwd)&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;   options      -h, --help - displays this text&quot;</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;                -n, --nodeploy - builds _deploy but does not push it\n&quot;</span>
      <span class="nb">shift</span>
<span class="nb">      exit</span>
    ;;
    -n|--nodeploy<span class="o">)</span>
      <span class="nv">NODEPLOY</span><span class="o">=</span><span class="s1">&#39;YES&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;No deploy: $NODEPLOY&quot;</span>
      <span class="nb">shift</span>
    ;;
    *<span class="o">)</span>
      <span class="nv">PROJECT</span><span class="o">=</span><span class="nv">$key</span>
      <span class="nb">shift</span>
    ;;
  <span class="k">esac</span>
<span class="k">done</span>

<span class="c">######### PRE-EXECUTION TESTS</span>

<span class="c"># test for no project name entered and not in a project already</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$PROJECT</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  if</span> <span class="o">[[</span> ! -d .git <span class="o">]]</span> ; <span class="k">then</span>
    <span class="c"># not in a project and no project name given</span>
    <span class="nb">echo</span> <span class="s2">&quot;Not in a project, or no project name given. Exiting ... &quot;</span>
    <span class="nb">exit </span>1
  <span class="k">else</span>
    <span class="c"># set project folder to present working directory</span>
    <span class="nv">PROJECT</span><span class="o">=</span><span class="k">${</span><span class="nv">PWD</span><span class="p">##*/</span><span class="k">}</span>
  <span class="k">fi</span>
<span class="k">else</span>
<span class="k">  if</span> <span class="o">[[</span> ! -d <span class="nv">$PROJECT</span> <span class="o">]]</span> ; <span class="k">then</span>
    <span class="c"># project folder does not exist</span>
    <span class="nb">echo</span> <span class="s2">&quot;Project folder \&quot;$PROJECT\&quot; does not exist. Exiting ... &quot;</span>
    <span class="nb">exit </span>1
  <span class="k">elif</span> <span class="o">[[</span> ! -d <span class="nv">$PROJECT</span>/.git <span class="o">]]</span> ; <span class="k">then</span>
    <span class="c"># no git repository in project</span>
    <span class="nb">echo</span> <span class="s2">&quot;Folder \&quot;$PROJECT\&quot; is not a git repository. Exiting ... &quot;</span>
    <span class="nb">exit </span>1
  <span class="k">else</span>
    <span class="c"># open project folder to set present working directory</span>
    <span class="nb">cd</span> <span class="nv">$PROJECT</span>
  <span class="k">fi</span>
<span class="k">fi</span>

<span class="c"># test for type of remote in main project</span>
<span class="nb">set</span> -- <span class="k">$(</span>git remote -v<span class="k">)</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
  <span class="c"># project has no remote</span>
  <span class="nb">echo</span> <span class="s2">&quot;Project \&quot;$PROJECT\&quot; has no remote. Exiting ... &quot;</span>
  <span class="nb">exit </span>1
<span class="k">else</span>
  <span class="c"># save remote name</span>
  <span class="nv">REMOTE</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">fi</span>

<span class="c"># test for embedded documentation project folder or main documentation project</span>
<span class="k">if</span> <span class="o">[[</span> -e <span class="nv">$DIR_DOC</span>/<span class="nv">$FILE_SPHINX</span> <span class="o">]]</span> ; <span class="k">then</span>
  <span class="c"># embedded sphinx documentation project found; set directory to it</span>
  <span class="nv">PROJECT</span><span class="o">=</span><span class="nv">$PROJECT</span>/<span class="nv">$DIR_DOC</span>
  <span class="nb">cd</span> <span class="nv">$DIR_DOC</span>
<span class="k">elif</span> <span class="o">[[</span> ! -e <span class="nv">$FILE_SPHINX</span> <span class="o">]]</span> ; <span class="k">then</span>
  <span class="c"># no embedded sphinx and not a sphinx project</span>
  <span class="nb">echo</span> <span class="s2">&quot;No sphinxdoc configuration or document folder missing, Exiting ...&quot;</span>
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># test for or create remote in documentation (sub)project</span>
<span class="nb">set</span> -- <span class="k">$(</span>git remote -v<span class="k">)</span>
<span class="nv">TEST</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">REMOTE_DEPLOY</span><span class="o">=</span><span class="nv">$2</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;${TEST#*$REMOTE}&quot;</span> <span class="o">=</span> <span class="s2">&quot;$TEST&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  if</span> <span class="o">[[</span> <span class="nv">$REMOTE</span> <span class="o">=</span> <span class="s2">&quot;heroku&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
    <span class="c"># project is deployed on Heroku, create documentation deployment there too</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\nCreating new heroku remote deployment for documentation\n&quot;</span>
    heroku create
    <span class="nb">echo</span> <span class="s2">&quot;$(git remote -v)&quot;</span>
    <span class="nb">set</span> -- <span class="k">$(</span>git remote -v<span class="k">)</span>
    <span class="nv">REMOTE_DEPLOY</span><span class="o">=</span><span class="nv">$2</span>
  <span class="k">else</span>
    <span class="c"># main project deployed somewhere and documentation remote not set</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;Use \&quot;git remote ... \&quot; to set deployment for $PROJECT. Exiting ...&quot;</span>
    <span class="nb">exit </span>1
  <span class="k">fi</span>
  <span class="c"># project has a remote; use it</span>
<span class="k">fi</span>

<span class="c"># set branch name for deploy pull and push</span>
<span class="k">case</span> <span class="nv">$REMOTE_DEPLOY</span> in
  *<span class="s2">&quot;github&quot;</span>*<span class="o">)</span>
    <span class="nv">BRANCH_DEPLOY</span><span class="o">=</span><span class="nv">$GITHUB</span>
    ;;
  *<span class="s2">&quot;heroku&quot;</span>*<span class="o">)</span>
    <span class="nv">BRANCH_DEPLOY</span><span class="o">=</span><span class="nv">$HEROKU</span>
    ;;
  **<span class="o">)</span>
    <span class="c"># this script does not know how to deploy to the specified remote</span>
    <span class="nb">echo</span> <span class="s2">&quot;Script does not support remote $REMOTE_DEPLOY. Exiting ...&quot;</span>
    <span class="nb">exit </span>1
    ;;
<span class="k">esac</span>

<span class="c">#  Project folder, supported remote, (embedded) sphinxdoc index.rst</span>

<span class="nb">echo</span> -e <span class="s2">&quot;\nDocumentation project folder is $PROJECT&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;Remote for documentation is at $REMOTE_DEPLOY&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;Documentation branches:\n$(git branch -a)&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;Documentation remotes:\n$(git remote -v) \n&quot;</span>

<span class="c">########## CONFIGURING DEPLOYMENT FOLDER</span>

<span class="nb">echo</span> <span class="s2">&quot;  --- CONFIGURING DEPLOYMENT ---&quot;</span>

<span class="c"># Read CNAME owner for github deployment, in case there is one</span>
<span class="k">if</span> <span class="o">[[</span> -e cnameowner <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nv">OWNER</span><span class="o">=</span><span class="k">$(</span>&lt;cnameowner<span class="k">)</span>
<span class="k">fi</span>

<span class="c"># in the event it is missing, create a git project deployment folder</span>
<span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$DIR_DEPLOY</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span>mkdir -p <span class="nv">$DIR_DEPLOY</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$DIR_DEPLOY</span>/.git <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;\nCreating deployment folder $DIR_DEPLOY\n&quot;</span>
  <span class="nb">cd</span> <span class="nv">$DIR_DEPLOY</span>
  git init
  git commit --allow-empty -m <span class="s2">&quot;empty first commit&quot;</span>
  <span class="nb">set</span> -- <span class="k">$(</span>git branch<span class="k">)</span>
  git branch -m <span class="nv">$2</span> <span class="nv">$DEPLOY</span>
  <span class="c"># ##</span>
  <span class="nb">echo</span> <span class="s2">&quot;git remote add origin $REMOTE_DEPLOY&quot;</span>
  <span class="c"># ##</span>
  git remote add origin <span class="nv">$REMOTE_DEPLOY</span>
  <span class="nb">echo</span> <span class="s2">&quot;BRANCH is \&quot;$(git branch -a)\&quot;&quot;</span>
  git fetch origin
  <span class="c"># git checkout -B $DEPLOY</span>
  <span class="c"># Save directory in git and Prevent jekyll markup interpretation</span>
  touch .gitkeep
  touch .gitignore
  touch .nojekyll
  git add --ignore-removal .
  git commit -m <span class="s2">&quot;hidden control files&quot;</span>
  <span class="nb">cd</span> ..
<span class="k">fi</span>

<span class="c"># Clean the deployment folder and pull the repository branch</span>
rm -rf <span class="nv">$DIR_DEPLOY</span>/*
<span class="nb">cd</span> <span class="nv">$DIR_DEPLOY</span>
<span class="c"># fatal error returned if remote site does not include the deploy branch</span>
<span class="nv">TEST</span><span class="o">=</span><span class="k">$(</span>git branch -a<span class="k">)</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$TEST&quot;</span> !<span class="o">=</span> <span class="s2">&quot;${TEST/$BRANCH_DEPLOY/}&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span>git pull -f origin <span class="nv">$BRANCH_DEPLOY</span>:<span class="nv">$DEPLOY</span>
<span class="k">fi</span>
<span class="nb">cd</span> ..

<span class="nb">echo</span> <span class="s2">&quot;  ----- CREATING OUTPUT -----&quot;</span>

<span class="c"># if no sections specified, look for a file &quot;sections&quot; listing sections</span>
<span class="k">if</span> <span class="o">[[</span> -e sections <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span>SECTIONS+<span class="o">=</span><span class="s2">&quot; &quot;</span><span class="k">$(</span>&lt;sections<span class="k">)</span>
<span class="k">fi</span>

<span class="c"># Compile fresh output for one or more books and copy to deployment folder</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$SECTIONS&quot;</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nv">DIR_OUT</span><span class="o">=</span><span class="nv">$DIR_DEPLOY</span>
  makedeployment
<span class="k">else</span>

  <span class="c"># Add shared static content</span>
  <span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$DIR_STATIC</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">    </span>cp -RH <span class="nv">$DIR_STATIC</span>/* <span class="nv">$DIR_DEPLOY</span>/
    <span class="c"># cp $DIR_STATIC/.ht* $DIR_DEPLOY/ &amp;&gt;/dev/null || RC=$?</span>
    cp -RH <span class="nv">$DIR_STATIC</span>/.ht* <span class="nv">$DIR_DEPLOY</span>/ &amp;&gt;/dev/null <span class="o">||</span> <span class="nv">RC</span><span class="o">=</span><span class="nv">$?</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$RC</span> &gt; 0 <span class="o">]]</span> ; <span class="k">then </span><span class="nb">echo</span> <span class="s2">&quot;$(pwd)$(tput setaf 1) $LINENO: cp -RH $DIR_STATIC/.ht* $DIR_DEPLOY/ $(tput sgr0)&quot;</span> ; <span class="k">fi</span>
<span class="k">  fi</span>

  <span class="c"># Make HTML, other deployment files</span>
  <span class="k">for </span>SECT in <span class="nv">$SECTIONS</span> ; <span class="k">do</span>
<span class="k">    if</span> <span class="o">[[</span> -d <span class="nv">$SECT</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">      </span><span class="nv">DIR_OUT</span><span class="o">=</span>../<span class="nv">$DIR_DEPLOY</span>/<span class="nv">$SECT</span>
      <span class="nb">cd</span> <span class="nv">$SECT</span>
        <span class="nb">echo</span> -e <span class="s2">&quot;$(tput setaf 2)\n Making section $SECT \n$(tput sgr0)&quot;</span>
        mkdir -p <span class="nv">$DIR_OUT</span>
        makedeployment
        <span class="c"># Copy MASTER from its deploy subdirectory</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$SECT</span> <span class="o">==</span> <span class="nv">$MASTER</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">          </span>cp -RH <span class="nv">$DIR_OUT</span>/* ../<span class="nv">$DIR_DEPLOY</span>/
          <span class="c"># cp $DIR_OUT/.ht* ../$DIR_DEPLOY/ &amp;&gt;/dev/null || RC=$?</span>
          cp -RH <span class="nv">$DIR_OUT</span>/.ht* ../<span class="nv">$DIR_DEPLOY</span>/ &amp;&gt;/dev/null <span class="o">||</span> <span class="nv">RC</span><span class="o">=</span><span class="nv">$?</span>
          <span class="k">if</span> <span class="o">[[</span> <span class="nv">$RC</span> &gt; 0 <span class="o">]]</span> ; <span class="k">then </span><span class="nb">echo</span> <span class="s2">&quot;$(pwd)$(tput setaf 1) $LINENO: cp -RH $DIR_OUT/.ht* ../$DIR_DEPLOY/ $(tput sgr0)&quot;</span> ; <span class="k">fi</span>
          <span class="c"># If it exists, delete CNAME from master deploy subdirectory</span>
          <span class="k">if</span> <span class="o">[[</span> -e <span class="nv">$DIR_OUT</span>/CNAME <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;CNAME $(&lt;$DIR_OUT/CNAME) found in $DIR_OUT/CNAME&quot;</span>
            rm <span class="nv">$DIR_OUT</span>/CNAME
          <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">      </span><span class="nb">cd</span> ..
    <span class="k">fi</span>
<span class="k">  done</span>

<span class="k">fi</span>

<span class="c"># if we are on gh-pages AND there exists a CNAME file</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$BRANCH_DEPLOY</span> <span class="o">=</span> <span class="nv">$GITHUB</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  if</span> <span class="o">[[</span> -e <span class="nv">$DIR_DEPLOY</span>/CNAME <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">    if</span> <span class="o">[[</span> <span class="s2">&quot;$REMOTE_DEPLOY&quot;</span> <span class="o">==</span> <span class="s2">&quot;${REMOTE_DEPLOY/$OWNER/}&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
      <span class="c"># removing $OWNER from remote leaves the remote unchanged, so:</span>
      <span class="c"># if $GITHUB and CNAME owner != remote deployer, remove CNAME</span>
      <span class="nb">echo </span>remote ^^<span class="nv">$REMOTE_DEPLOY</span>^^ does not belong to CNAME <span class="nv">owner</span><span class="o">=</span>^^<span class="s2">&quot;$OWNER&quot;</span>^^
      rm <span class="nv">$DIR_DEPLOY</span>/CNAME
    <span class="k">fi</span>
<span class="k">  fi</span>
<span class="k">fi</span>

<span class="c"># Deploy the repository branch</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$NODEPLOY</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">exit</span>
<span class="k">elif</span> <span class="o">[[</span> -d <span class="nv">$DIR_DEPLOY</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">cd</span> <span class="nv">$DIR_DEPLOY</span>
  git add -A .
  git commit -m <span class="s2">&quot;Deployed documentation&quot;</span>
  git push -u origin <span class="nv">$DEPLOY</span>:<span class="nv">$BRANCH_DEPLOY</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;\npushed to origin branch $DEPLOY:$BRANCH_DEPLOY\n&quot;</span>
  <span class="nb">cd</span> ..
<span class="k">fi</span>

<span class="c">######### NORMAL EXIT</span>

<span class="nb">echo</span> <span class="s2">&quot;  --- FINISHED ---&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Check all messages for possible errors.&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Then commit and push source changes as well.&quot;</span>

<span class="c"># Authors: Gerald Lovel, glovel@aaltsys.com; Julia Lovel, jlovel@aaltsys.com</span>

<span class="c"># 12/17/2012 - GARL -- Added copy master folder contents to $DIR_DEPLOY root</span>
<span class="c"># 02/20/2013 - GARL -- Added support for deployment to Heroku, Github, ...</span>
<span class="c"># 03/10/2013 - GARL -- Embedded documentation in code projects added</span>
<span class="c"># 11/15/2013 - GARL -- Updated cnameowner mismatch error messages to display spaces</span>
<span class="c"># 08/20/2014 - GARL -- Added link backreference insertion in HTML output</span>
<span class="c"># 09/10/2014 - GARL -- Added option checking for NODEPLOY, PROJECT</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">Linux Shell Script Programming 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>