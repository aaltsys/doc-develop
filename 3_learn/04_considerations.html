<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming Considerations &mdash; Linux Shell Script Programming 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Linux Shell Script Programming 1.0 documentation" href="index.html" />
    <link rel="next" title="Attending Conventions" href="05_lesson2.html" />
    <link rel="prev" title="Shell Scripting Exercise" href="03_lesson1.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="05_lesson2.html" title="Attending Conventions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="03_lesson1.html" title="Shell Scripting Exercise"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Linux Shell Script Programming 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Programming Considerations</a><ul>
<li><a class="reference internal" href="#general-programming-concerns">General Programming Concerns</a><ul>
<li><a class="reference internal" href="#routinely-idempotent">Routinely Idempotent</a></li>
<li><a class="reference internal" href="#keeping-to-the-path">Keeping to the Path</a></li>
<li><a class="reference internal" href="#generalize-for-recycling">Generalize for Recycling</a></li>
<li><a class="reference internal" href="#file-configurations">File Configurations</a></li>
<li><a class="reference internal" href="#colorize-my-output-world">Colorize My Output World</a></li>
<li><a class="reference internal" href="#debugging-statements">Debugging Statements</a></li>
<li><a class="reference internal" href="#readable-code">Readable Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="03_lesson1.html"
                        title="previous chapter">Shell Scripting Exercise</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="05_lesson2.html"
                        title="next chapter">Attending Conventions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/04_considerations.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="programming-considerations">
<span id="considerations"></span><h1>Programming Considerations<a class="headerlink" href="#programming-considerations" title="Permalink to this headline">¶</a></h1>
<p>Learning shell scripting may seem a bit esoteric. However, shell is an easy
environment for learning important concepts in programming; concepts which are
often overlooked in traditional programming language courses. This section will
look at these considerations in two parts: Those items that apply to programming
in general, and those that are specific to Linux shell scripting.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">System variable <tt class="docutils literal"><span class="pre">$PWD</span></tt> contains a user&#8217;s Present Working Directory or path.</p>
</div>
<div class="section" id="general-programming-concerns">
<h2>General Programming Concerns<a class="headerlink" href="#general-programming-concerns" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title">Non-idempotent routine</p>
<div class="last highlight-bash"><div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> ! -d <span class="s1">&#39;~/Projects/dummy&#39;</span> <span class="o">]</span>
<span class="k">then</span>
<span class="k">  </span>mkdir -p <span class="s1">&#39;~/Projects/dummy&#39;</span>
  <span class="nb">cd</span> <span class="s1">&#39;~/Projects/dummy&#39;</span>
<span class="k">fi</span>
cp <span class="s1">&#39;/usr/bin/m*&#39;</span> .
</pre></div>
</div>
</div>
<div class="section" id="routinely-idempotent">
<h3>Routinely Idempotent<a class="headerlink" href="#routinely-idempotent" title="Permalink to this headline">¶</a></h3>
<p>When a routine has the same effect if it is performed multiple times as when
it is run once, the routine is said to be <strong>idempotent</strong>. The typical
<strong class="program">hello-world.sh</strong> program is idempotent, because the effect of the
program does not change with multiple executions.</p>
<p>Now look at the sidebar code. The first time that code is executed, files will
be copied to new directory <tt class="file docutils literal"><span class="pre">~/Projects/dummy</span></tt>. The next time the code is
executed, files will be copied to <tt class="docutils literal"><span class="pre">$PWD</span></tt>. Ouch! If a script can be run once
from the terminal, it may be run multiple times. Therefore every shell script
must be tested and verified to be idempotent.</p>
<p>Programmers often overlook such problems, as the invoice import feature in
<strong class="program">QuickBooks Accounting</strong> demonstrates. <strong class="program">QuckBooks</strong> creates
additional postings for invoices with every repeated import, rather than
posting just the first time.</p>
<div class="sidebar">
<p class="first sidebar-title">Validating Paths</p>
<div class="last highlight-bash"><div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> ! -d .git <span class="o">]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;No .git directory, exiting ... &quot;</span>
  <span class="nb">exit </span>1
<span class="k">else</span>
  <span class="c"># set project folder to present working directory</span>
  <span class="nv">PROJECT</span><span class="o">=</span><span class="k">${</span><span class="nv">PWD</span><span class="p">##*/</span><span class="k">}</span>
  <span class="k">if</span> <span class="o">[</span> -e <span class="s1">&#39;.git/description&#39;</span> <span class="o">]</span>
  <span class="k">then </span>cat .git/description
  <span class="k">fi</span>
<span class="k">fi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="keeping-to-the-path">
<h3>Keeping to the Path<a class="headerlink" href="#keeping-to-the-path" title="Permalink to this headline">¶</a></h3>
<p>File paths can be problematic when writing shell scripts. A script can be copied
from one directory to another, which may change its startup directory. Or, a
script may be called at a directory other than the user&#8217;s present working
directory (<tt class="docutils literal"><span class="pre">$PWD</span></tt>). A script can be called from some other function, and
<tt class="docutils literal"><span class="pre">$PWD</span></tt> could be anything in that case. Unixes vary in their system directory
layouts. Therefore any path or filename used in a script must be validated
before file or directory operations.</p>
<p>Some popular test logic operators for files are shown below. See
<em class="xref std std-ref">../resources/test-file</em> for a detailed list.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Test</th>
<th class="head">File condition which returns true</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>-e</td>
<td>file exists</td>
</tr>
<tr class="row-odd"><td>-f</td>
<td>a regular file, not a directory or device</td>
</tr>
<tr class="row-even"><td>-s</td>
<td>file is not zero size</td>
</tr>
<tr class="row-odd"><td>-d</td>
<td>file is a directory</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The consequence of not validating files and paths before performing file I/O
might be a broken system.</p>
</div>
<div class="sidebar">
<p class="first sidebar-title">Generalized confirmation</p>
<div class="last highlight-bash"><div class="highlight"><pre>MSG-CONFIRM<span class="o">=</span><span class="s1">&#39;Say Hello&#39;</span>
<span class="c"># ...</span>
<span class="c"># User Confirmation:</span>
<span class="c"># requires MSG-CONFIRM, assigns EXIT</span>
<span class="nb">echo</span> -e -n <span class="s1">&#39;\n\e[1;31m $MSG-CONFIRM&#39;</span>
<span class="nb">read</span> -n 1 -p <span class="s1">&#39; (y/n)?&#39;</span> RESP
<span class="nb">echo</span> -e <span class="s1">&#39;\e[0m&#39;</span>
<span class="k">case</span> <span class="nv">$RESP</span> in
  y|Y<span class="o">)</span>
    <span class="nv">EXIT</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
  n|N<span class="o">)</span>
    <span class="nv">EXIT</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>
  *<span class="o">)</span>
    <span class="nv">EXIT</span><span class="o">=</span><span class="s1">&#39;2&#39;</span>
<span class="k">esac</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generalize-for-recycling">
<h3>Generalize for Recycling<a class="headerlink" href="#generalize-for-recycling" title="Permalink to this headline">¶</a></h3>
<p>A previous lesson presented a code snippet to obtain a user confirmation:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">echo</span> -e -n <span class="s1">&#39;\n\e[1;31m Say Hello&#39;</span>
<span class="nb">read</span> -n 1 -p <span class="s1">&#39; (y/n)?&#39;</span> RESP
<span class="nb">echo</span> -e <span class="s1">&#39;\e[0m&#39;</span>
...
</pre></div>
</div>
<p>This piece of code is too specific; because it contains the phrase &#8220;Say Hello,&#8221;
it is useful only in our &#8220;Hello World&#8221; example. Placing the text &#8220;Say Hello&#8221; in
a variable and assigning it in our variable declarations will generalize the
snippet and allow it to be used in any script without further code changes.
This will save programming and testing time down the road.</p>
<p>There are other reasons to assign strings to variables in declarations at the
top of a program. Configuration information will be exposed in the variable
declarations instead of being buried in the script, and changing the variable&#8217;s
language will translate the script for the user.</p>
<div class="sidebar">
<p class="first sidebar-title">Reading a configuration file</p>
<div class="last highlight-bash"><div class="highlight"><pre><span class="c"># assign configuration to variables</span>
<span class="c"># config-file lines format: VARNAME=VALUE</span>
<span class="c"># uses &quot;printf -v NAME VALUE&quot;</span>
<span class="c">#</span>
<span class="c"># requires FILE-CONFIG, assigns VAR-NAME, VAR-VALUE</span>
<span class="k">if</span> <span class="o">[</span> -s <span class="s2">&quot;$FILE-CONFIG&quot;</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="c"># read configuration into array</span>
  <span class="nv">SAVEIFS</span><span class="o">=</span><span class="nv">$IFS</span>
  <span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\n&#39;</span>
  <span class="nv">VARLIST</span><span class="o">=(</span><span class="k">$(</span>&lt;<span class="s2">&quot;$FILE-CONFIG&quot;</span><span class="k">)</span><span class="o">)</span>
  <span class="nv">IFS</span><span class="o">=</span><span class="nv">$SAVEIFS</span>
  <span class="c"># assign array to named variables using printf -v</span>
  <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span>0; i&lt;<span class="k">${#</span><span class="nv">VARLIST</span><span class="p">[@]</span><span class="k">}</span>; i++ <span class="o">))</span>
  <span class="k">do</span>
<span class="k">    </span>VAR-NAME<span class="o">=</span><span class="k">${</span><span class="nv">VARLIST</span><span class="p">[i]%%=*</span><span class="k">}</span>
    VAR-VALUE<span class="o">=</span><span class="k">${</span><span class="nv">VARLIST</span><span class="p">[i]##*=</span><span class="k">}</span>
    <span class="nb">printf</span> -v <span class="nv">$VAR</span>-NAME <span class="nv">$VAR</span>-VALUE
  <span class="k">done</span>
<span class="k">fi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="file-configurations">
<h3>File Configurations<a class="headerlink" href="#file-configurations" title="Permalink to this headline">¶</a></h3>
<p>Many variables have meaning only in the internal context of a program. Others
may be displayed to the user, and so language could be a concern. Then, there
are variables which represent configuration settings for a system. We would
want to change program configuration items without re-writing code, so
configuration settings should be stored in a text file, and not hard coded.</p>
<p>A common form of configuration file is structured just like variable assignment
declarations. In fact, a program usually contains exactly the same statements
as default variable declarations, followed by a routine to override the defaults
with configuration values: maybe from a global file, then from a user file.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Unixes store most configuration files in directory <tt class="file docutils literal"><span class="pre">/etc/</span></tt>, or as
hidden files in the user&#8217;s home directory <tt class="file docutils literal"><span class="pre">~/</span></tt>.</p>
</div>
<p>So the contents of a simple configuration file would be lines like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">VARIABLE1</span><span class="o">=</span>VALUE1
<span class="nv">VARIABLE2</span><span class="o">=</span>VALUE2
...
</pre></div>
</div>
<p>The sidebar shows a generic routine to convert such a text file into assigned
variables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A comment test is missing from the <tt class="docutils literal"><span class="pre">do</span> <span class="pre">..</span> <span class="pre">done</span></tt> loop. This would entail
checking the first non-whitespace character on a line, to see if it is a
<tt class="docutils literal"><span class="pre">#</span></tt>, or to check for blank lines.</p>
</div>
</div>
<div class="section" id="colorize-my-output-world">
<h3>Colorize My Output World<a class="headerlink" href="#colorize-my-output-world" title="Permalink to this headline">¶</a></h3>
<p>There are two commands for displaying text on the terminal: <strong class="command">printf</strong>,
and <strong class="command">echo</strong>. While <strong class="command">printf</strong> behaves more consistently across
platforms, the guide will discuss <strong class="command">echo</strong>.</p>
<p>Similarly, there are two Unix conventions for formatting terminal text: embedded
<tt class="docutils literal"><span class="pre">VT100</span> <span class="pre">Codes</span></tt>, and <strong class="command">tput</strong> commands.</p>
</div>
<div class="section" id="debugging-statements">
<h3>Debugging Statements<a class="headerlink" href="#debugging-statements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">echo</span> <span class="s2">&quot;$PWD$(tput setaf 1) $LINENO: $MSG-COMMAND $(tput sgr0)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="readable-code">
<h3>Readable Code<a class="headerlink" href="#readable-code" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="05_lesson2.html" title="Attending Conventions"
             >next</a></li>
        <li class="right" >
          <a href="03_lesson1.html" title="Shell Scripting Exercise"
             >previous</a> |</li>
        <li><a href="index.html">Linux Shell Script Programming 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>